[base]
exe = $SSH 'pip3 install sphinx recommonmark'
dep[] = base-software:installed

[php-code]
exe = $SCP $SCRIPT/webhook/github-webhook.php  $SSH_USER@$IP:/var/www/html/
dep[] = httpd:base

[guide-code]
exe = $SSH 'bash -s' -- < $SCRIPT/git-mirror.sh 'https://github.com/approach0/guide.git' /var/www/html/guide-code
dep[] = webhook:base

[guide-build]
exe = $SSH 'cd /var/www/html/guide-code && sphinx-build -b html -d _build/doctrees . _build/html'
dep[] = webhook:guide-code

[guide-link]
exe = $SSH 'ln -sf /var/www/html/{guide-code/_build/html,guide}'
dep[] = webhook:guide-build

[docs-code]
exe = $SSH 'bash -s' -- < $SCRIPT/git-mirror.sh 'https://github.com/approach0/docs.git' /var/www/html/docs-code
dep[] = webhook:base

[docs-build]
exe = $SSH 'cd /var/www/html/docs-code && sphinx-build -b html -d _build/doctrees . _build/html'
dep[] = webhook:docs-code

[docs-link]
exe = $SSH 'ln -sf /var/www/html/{docs-code/_build/html,docs}'
dep[] = webhook:docs-build

[ready]
exe = "chown -R www-data:www-data guide-code && docs-code"
dep[] = webhook:docs-link
dep[] = webhook:guide-link
dep[] = webhook:php-code
