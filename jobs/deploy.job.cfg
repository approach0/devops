[a0-publish]
exe = $SSH 'rsync -ru --delete --progress a0/demo/web/. /var/www/html/search'
dep[] = repo:a0-build
dep[] = httpd:http-update

[a0-demo-link]
exe = $SSH 'ln -sf /var/www/html/search /var/www/html/demo'
dep[] = deploy:a0-publish

[a0-index-upload]
exe = rsync -z --progress $INDEX_IMG $RSYNC_ADDR/$(basename $INDEX_IMG)
dep[] = rsyncd:list

[a0-ready-run]
exe = $SSH 'bash -s' -- < $SCRIPT/a0-update-index-img.sh "$(basename $INDEX_IMG)" $RANK
dep[] = deploy:a0-demo-link
dep[] = deploy:a0-index-upload

[a0-master]
exe = $SSH "tmux new -d -s 'searchd' '$A0_MASTER_RUN'"
if = [ $RANK -eq 0 ]
dep[] = deploy:a0-ready-run
